const activateBtn = document.getElementById('activate');
const deactivateBtn = document.getElementById('deactivate');

activateBtn.style.background = 'transparent';
deactivateBtn.style.background = 'transparent';
activateBtn.style.border = '2px solid black';
deactivateBtn.style.border = '2px solid black';

const COLORS = { green: '#68ce08', red: '#df341d' };

function sendContentScriptMessage(command) {
  browser.tabs.query({ active: true, currentWindow: true }).then((tabs) => {
    browser.tabs.sendMessage(tabs?.[0]?.id, {
      command,
    });
  });
}

activateBtn?.addEventListener('click', () => {
  sendContentScriptMessage('activate');
  browser.storage.local.set({ youtubeIsActive: true });
  activateBtn.style.background = COLORS.green; // green
  deactivateBtn.style.background = 'transparent';
});

deactivateBtn?.addEventListener('click', () => {
  sendContentScriptMessage('deactivate');
  browser.storage.local.set({ youtubeIsActive: false });
  deactivateBtn.style.background = '#df341d'; // red
  activateBtn.style.background = 'transparent';
});

function setStatePopup(state) {
  if (state.youtubeIsActive === true) {
    activateBtn.style.background = '#68ce08'; // green
    deactivateBtn.style.background = 'transparent';
  } else if (state.youtubeIsActive === false) {
    deactivateBtn.style.background = COLORS.red; // red
    activateBtn.style.background = 'transparent';
  }
}

// browser.storage.local.clear();

browser.storage.local.get('youtubeIsActive').then(setStatePopup);
